import sys
import itertools

def get_val(a, pos, mode, rel=None):
    if mode == 0:
        return a[a[pos]]
    elif mode == 1:
        return a[pos]
    elif mode ==2:
        return a[a[pos] + rel]

def set_val(a, pos, mode, val, rel=None):
    if mode == 0:
       a[a[pos]] = val
    elif mode == 1:
       a[pos] = val
    if mode == 2:
       a[a[pos] + rel] = val

def new_pos(pos, r):
    if r == 0:
        r = -1

    pos[2] += r
    pos[2] = pos[2] % 4

    if pos[2] == 0:
        pos[1] += 1
    elif pos[2] == 2:
        pos[1] += -1
    elif pos[2] == 1:
        pos[0] += 1
    elif pos[2] == 3:
        pos[0] += -1


def intcode_v3(a=None, init=None):
    out = list()
    pos = [0,0,0]
    pos_list = [pos]
    whites = list()
    painted = dict()
    i = 0
    rel_base = 0
    while a[i]!=99:
        if a[i] % 100 == 1:
            f = a[i] // 100 % 10
            s = a[i] // 1000 % 10
            t = a[i] // 10000 % 10

            f = get_val(a, i+1, f, rel_base)
            s = get_val(a, i+2, s, rel_base)

            set_val(a, i+3, t, val=f + s, rel=rel_base)
            i = i+4
        elif a[i] % 100 == 2:
            f = a[i] // 100 % 10
            s = a[i] // 1000 % 10
            t = a[i] // 10000 % 10

            f = get_val(a, i+1, f, rel_base)
            s = get_val(a, i+2, s, rel_base)

            set_val(a, i+3, t, f * s, rel=rel_base)

            i = i+4

        elif a[i] % 100 == 3:
            t = a[i] // 100 % 10
            set_val(a, i+1, t, val=init.pop(0), rel=rel_base)
            i += 2

        elif a[i] % 100 == 4:
            t = a[i] // 100 % 10
            out.append(get_val(a, i+1, t, rel_base))
            if len(out) == 2:
                painted[tuple(pos[0:2])] = out.pop(0)
                new_pos(pos, out.pop(0))
                pos_list.append(pos)
                if pos[0:2] in whites:
                    print("already painted")
                    init.append(1)
                else:
                    init.append(0)

            i = i+2

        elif a[i] % 100 == 5:
            f = a[i] // 100 % 10
            s = a[i] // 1000 % 10

            f = get_val(a, i+1, f, rel_base)
            s = get_val(a, i+2, s, rel_base)

            if f != 0:
                i = s
            else:
                i = i+3

        elif a[i] % 100 == 6:
            f = a[i] // 100 % 10
            s = a[i] // 1000 % 10

            f = get_val(a, i+1, f, rel_base)
            s = get_val(a, i+2, s, rel_base)

            if f == 0:
                i = s
            else:
                i = i+3

        elif a[i] % 100 == 7:
            f = a[i] // 100 % 10
            s = a[i] // 1000 % 10
            t = a[i] // 10000 % 10

            f = get_val(a, i+1, f, rel_base)
            s = get_val(a, i+2, s, rel_base)

            if f < s:
               # a[a[i+3] + offset_t] = 1
                set_val(a, i+3, t, 1, rel=rel_base)
            else:
                #a[a[i+3] + offset_t] = 0
                set_val(a, i+3, t, 0, rel=rel_base)
            i += 4
        elif a[i] % 100 == 8:
            f = a[i] // 100 % 10
            s = a[i] // 1000 % 10
            t = a[i] // 10000 % 10

            f = get_val(a, i+1, f, rel_base)
            s = get_val(a, i+2, s, rel_base)

            if f == s:
#                a[a[i+3] + offset_t] = 1
                set_val(a, i+3, t, 1, rel=rel_base)
            else:
#               a[a[i+3] + offset_t] = 0
                set_val(a, i+3, t, 0, rel=rel_base)
            i += 4

        elif a[i] % 100 == 9:
            f = a[i] // 100 % 10
            f = get_val(a, i+1, f, rel_base)

            rel_base += f
            i += 2
#    print(whites)
#    print(len(whites))
#    print(pos_list)
    print(pos_list)
    print(painted)
    print(len(painted))

b = [3,8,1005,8,310,1106,0,11,0,0,0,104,1,104,0,3,8,102,-1,8,10,1001,10,1,10,4,10,108,1,8,10,4,10,1002,8,1,28,1,105,11,10,3,8,102,-1,8,10,1001,10,1,10,4,10,1008,8,0,10,4,10,102,1,8,55,3,8,102,-1,8,10,1001,10,1,10,4,10,108,0,8,10,4,10,1001,8,0,76,3,8,1002,8,-1,10,101,1,10,10,4,10,108,0,8,10,4,10,102,1,8,98,1,1004,7,10,1006,0,60,3,8,102,-1,8,10,1001,10,1,10,4,10,108,0,8,10,4,10,1002,8,1,127,2,1102,4,10,1,1108,7,10,2,1102,4,10,2,101,18,10,3,8,1002,8,-1,10,1001,10,1,10,4,10,1008,8,0,10,4,10,102,1,8,166,1006,0,28,3,8,1002,8,-1,10,101,1,10,10,4,10,108,1,8,10,4,10,101,0,8,190,1006,0,91,1,1108,5,10,3,8,1002,8,-1,10,101,1,10,10,4,10,1008,8,1,10,4,10,1002,8,1,220,1,1009,14,10,2,1103,19,10,2,1102,9,10,2,1007,4,10,3,8,1002,8,-1,10,101,1,10,10,4,10,1008,8,1,10,4,10,101,0,8,258,2,3,0,10,1006,0,4,3,8,102,-1,8,10,1001,10,1,10,4,10,108,1,8,10,4,10,1001,8,0,286,1006,0,82,101,1,9,9,1007,9,1057,10,1005,10,15,99,109,632,104,0,104,1,21102,1,838479487636,1,21102,327,1,0,1106,0,431,21102,1,932813579156,1,21102,1,338,0,1106,0,431,3,10,104,0,104,1,3,10,104,0,104,0,3,10,104,0,104,1,3,10,104,0,104,1,3,10,104,0,104,0,3,10,104,0,104,1,21101,0,179318033447,1,21101,385,0,0,1105,1,431,21101,248037678275,0,1,21101,0,396,0,1105,1,431,3,10,104,0,104,0,3,10,104,0,104,0,21101,0,709496558348,1,21102,419,1,0,1105,1,431,21101,825544561408,0,1,21101,0,430,0,1106,0,431,99,109,2,22101,0,-1,1,21101,40,0,2,21102,462,1,3,21101,0,452,0,1106,0,495,109,-2,2105,1,0,0,1,0,0,1,109,2,3,10,204,-1,1001,457,458,473,4,0,1001,457,1,457,108,4,457,10,1006,10,489,1101,0,0,457,109,-2,2106,0,0,0,109,4,2101,0,-1,494,1207,-3,0,10,1006,10,512,21101,0,0,-3,22101,0,-3,1,22101,0,-2,2,21101,1,0,3,21102,531,1,0,1105,1,536,109,-4,2105,1,0,109,5,1207,-3,1,10,1006,10,559,2207,-4,-2,10,1006,10,559,22101,0,-4,-4,1106,0,627,21202,-4,1,1,21201,-3,-1,2,21202,-2,2,3,21102,578,1,0,1105,1,536,22101,0,1,-4,21101,1,0,-1,2207,-4,-2,10,1006,10,597,21102,0,1,-1,22202,-2,-1,-2,2107,0,-3,10,1006,10,619,21201,-1,0,1,21102,1,619,0,105,1,494,21202,-2,-1,-2,22201,-4,-2,-4,109,-5,2106,0,0]
for i in range(100000):
    b.append(0)
intcode_v3(b, [0])
print('done')
#print(b)

